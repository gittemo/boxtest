name: Dflow

on:
  workflow_dispatch:
    inputs:
      portfolio-app:
        type: boolean
        required: true
        default: false

      other-box:
        type: boolean
        required: true
        default: false

jobs:
  portfolio-app:
    if: ${{ github.event.inputs['portfolio-app'] }}
    name: deploy
    runs-on: portfolio-app-runner

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: dflow-deploy
        uses: "./.github/actions/dflow-deploy"
        with:
          directory: "cmd/portfolio/fund"
          name: portfolio-app
          port_map: "80:80"

  other-box:
    if: ${{ github.event.inputs['other-box'] }}
    name: deploy
    runs-on: other-box-runner

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: dflow-deploy
        uses: "./.github/actions/dflow-deploy"
        with:
          directory: "cmd/boxes/other"
          name: other-box
          port_map: "80:80"